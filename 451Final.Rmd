---
title: "451Project"
author: "Ling Ma, Debbie Sun"
date: "10/8/2020"
output: html_document
---
# Data Preprocessing
```{r,message=FALSE}
# Loading
library(dplyr)
library(naniar)
library(pcalg)
library(ggplot2)
library(dagitty)
```
+ `country`: recipient country
+ `year`: year
+ `US_ODA`: U.S. Official development assistance(treatment), defined as government aid designed to promote the economic development and welfare of developing countries[1]. 
+ `US_OOF`: U.S. Other Official Flows, transactions by the official sector with countries on the List of Aid Recipients which do not meet the conditions for eligibility as Official Development Assistance or Official Aid. 
+ `US_aid_total`: U.S. total aid the recipient received.
+ `Rest_of_world_ODA`: ODA except for U.S. and China(data of China is largely missing) the recipient received.
+ `Rest_of_world_OOF`: OOF except for U.S. and China(data of China is largely missing) the recipient received.
+ `Rest_of_world_aid_total`: rest of world total recipient received.
+ `polity2`:Recipient Polity Score,  "-10 (hereditary monarchy) to +10 (consolidated democracy)"
+ `oda_gni`: ODA in percentage in gross national income of the recipient's.
+ `population`:the total population of the recipient in that year.
+ `recipient_trade_world`:Recipient Total Trade with World
+ `GDP_per_growth_rate`: Recipient's GDP Per Capita growth rate, calculated by (this year - previous year)/previous year.
+ `GDP_total_growth_rate`: Recipient's total GDP growth rate, calculated by (this year - previous year)/previous year.
+ `population_growth_rate`: Recipient's Population growth rate, calculated by (this year - previous year)/previous year.


```{r pressure, echo=FALSE}
aid = read.csv("processed.csv")
aid$GDP_total_growth_rate = as.double(aid$GDP_total_growth_rate)
head(aid)
```
First, let's visualize the distribution of the missing data.
```{r}
vis_miss(aid)
vis_miss(aid,cluster = TRUE)
```
we decide to drop the observations that have missing values for the following reason:
1. "MNAR: Missing Not at Random - the missing is not random, it correlates with unobservable characteristics unknown to a researcher." The missing rows gather around the last 400 rows, so we cannot assume the missing is at random. 
2. we can afford to drop 7.7% of the original data as we still have 92.3% data left.

To get away with the time correlated concern, we decide to base our analysis on 2007 and 2012 because they have the least missing data. We conduct analysis on one of them, and use the result of the other one  to compare, which serves as a part of sensitive analysis to test the robustness of the former.

```{r}
aid = aid %>%
  na.omit(aid)

aid2007 = aid %>%
  filter(year==2007)

aid2012 = aid %>%
  filter(year==2012)
```

![](causal_graph.png)


# Causal Discovery


```{r echo=FALSE}
dag <- dagitty("
dag {
bb=\"0,0,1,1\"
\"A:US_ODA\" [exposure,pos=\"0.272,0.239\"]
\"Y:Recipient_GDP_growth_rate\" [outcome,pos=\"0.672,0.254\"]
national_demand [latent,pos=\"0.540,0.050\"]
oda_gni [pos=\"0.446,0.310\"]
polity2 [pos=\"0.357,0.039\"]
population_growth_rate [pos=\"0.651,0.028\"]
recipient_trade_world [pos=\"0.412,0.504\"]
rest_world_aid [pos=\"0.397,0.159\"]
\"A:US_ODA\" -> \"Y:Recipient_GDP_growth_rate\"
\"A:US_ODA\" -> oda_gni
national_demand -> \"Y:Recipient_GDP_growth_rate\"
national_demand -> oda_gni
national_demand -> recipient_trade_world
oda_gni -> \"Y:Recipient_GDP_growth_rate\"
polity2 -> \"A:US_ODA\"
polity2 -> \"Y:Recipient_GDP_growth_rate\"
polity2 -> national_demand
polity2 -> rest_world_aid
population_growth_rate -> \"Y:Recipient_GDP_growth_rate\"
population_growth_rate -> national_demand
recipient_trade_world -> \"A:US_ODA\"
recipient_trade_world -> \"Y:Recipient_GDP_growth_rate\"
recipient_trade_world -> rest_world_aid
rest_world_aid -> \"Y:Recipient_GDP_growth_rate\"
rest_world_aid -> oda_gni
}
")
plot(dag)
```
The causal graph is constructed based on our prior assumptions and common sense:

1. The outcome(Y: GDP growth rate of the recipient) depends on the national demand, population growth rate, the foreign aid received, potentially its autocracy-democracy index(polity2), and the recipient’s openness (measured by its global trade).

2. We assume that our treatment, US ODA, affect the outcome via direct effect(the recipient receives the aid) and indirect effect of ODA_GNI. The idea for GNI is that given the same amount of foreign aid, if the aid amounts to a large portion of the recipient’s gross national income, this aid should have a larger impact on the recipient. A similar idea applies to the foreign aid provided by the rest of the world.

3. We assume the recipient country’s openness to global trading contributes to not only GDP growth but also the amount of aid it’s going to receive. The rationale behind the assumption is the potential economic welfare gains from an aid could strongly motivate the donor. For example, the donor might want to have an impact on, or take a share of, the recipient’s market. Finally, we think it’s reasonable to assume that national demand affects the recipient’s global trade.

4. The assumption we made polity2 a confounder that has an impact on a wide range of other variables. The rationale behind this assumption is that the donors might also be motivated by enlarging their political impact on the recipient, such as winning over political support. 


### alpha = 0.01

```{r}
causalAid = aid2012 %>%
  dplyr::select(-X,-country,-year)
suff_stat <- list(C = cor(causalAid), n = nrow(causalAid))
pc_aid <- pc(suff_stat, indepTest = gaussCItest, labels = colnames(causalAid), alpha = 0.01, skel.method = "stable.fast")

plot(pc_aid, main = "")
```

With a threshold of 0.01, the outcome is entirely seperated from the rest of variables. Therefore, we believe 0.01 is too strict and thus relax it to 0.05.

### alpha=0.05
```{r}
pc_aid <- pc(suff_stat, indepTest = gaussCItest, labels = colnames(causalAid), alpha = 0.05, skel.method = "stable.fast")
plot(pc_aid, main = "")
```

### alpha=0.12
```{r}
pc_aid <- pc(suff_stat, indepTest = gaussCItest, labels = colnames(causalAid), alpha = 0.12, skel.method = "stable.fast")
plot(pc_aid, main = "")
```

Comparing the resulted causal graph with our assumptions, we spot the following causal flow that we didn't identify before:

>
1. it's mainly ODA, instead of OOF, that contributes to other variables. For example, the graph shows that US_ODA has a direct effect on popolucation growth rate, which stimulates GDP growth. Rest_of_Work_ODA also contributes to population, which directly affects recipient's world trade. 
2. US_ODA has a direct effect on Rest_of_Work_ODA, which motivates us to visualize their relation to see if they might be interactive terms.
3. oda_gni directly affects recipient_trade_world.

As we relax the treshold from 0.01 to 0.12, there are a few changes we think might be of interests:

>
1. when threshold is 0.01, recipient_trade_world contributes to population. When threshold increases, it's polulation contributes to recipient_trade_world. Therefore, both directions worth exploring in our later sensitivity analysis.
2. when threshold increases to 0.12, polity2 is considered to contribute to population growth. 

It appears that the way variables affect the outcome is via population growth.


# Regression Model
## Initial Visualization
GDP growth rate vs. US foreign aid (Treatment vs. Outcome)
```{r}
ggplot(data = aid2007,aes(y = GDP_total_growth_rate,x = log(US_aid_total)))+
  geom_point()+
  geom_smooth()
```

Other variables vs. Outcome

```{r}
ggplot(aid2007, aes(  y = GDP_total_growth_rate, x = population_growth_rate)) + 
  geom_point()+
  geom_smooth(
    
  )
```


## Regression Model
```{r}
mod <- lm(GDP_total_growth_rate~ US_aid_total +recipient_trade_world+polity2+population_growth_rate,data = aid2007)
summary(mod)
confint(mod)
```



# Sensivity Analysis

## Different Year (2012)


## Another Measurement of Economic growth



# Limitations 



# Reference

1. Official development assistance (ODA) - Net ODA - OECD Data. (n.d.). Retrieved October 18, 2020, from https://data.oecd.org/oda/net-oda.htm


















