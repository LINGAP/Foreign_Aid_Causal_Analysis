---
title: "451Project"
author: "Ling Ma, Debbie Sun"
date: "10/8/2020"
output: html_document
---
# Data Preprocessing
```{r,message=FALSE}
# Loading
library(dplyr)
library(naniar)
library(pcalg)
library(lme4)
library(ggplot2)
library(merTools) #we use this package because we need to use the "predictInterval" function
library(dagitty)
```

`US_ODA`: `A`(treatment), the amount of foreign aid given by the U.S. 
`US_OOF`: Other Official Flows
`US_aid_total`:total aid
`polity2`:Recipient Polity Score,  "-10 (hereditary monarchy) to +10 (consolidated democracy)"
`oda_gni`: ODA in percentage in gross national income
`gdp_percap_real`:Recipient GDP Per Capita

`population`: Recipient Population (a-b)/b
`recipient_trade_world`:Recipient Total Trade with World
`gdp_per_growth`: GDP per capita growth (a-b)/b
`GDP_total_growth`: GDP total growth

```{r pressure, echo=FALSE}
aid = read.csv("processed.csv")
aid$GDP_total_growth_rate = as.double(aid$GDP_total_growth_rate)
head(aid)
```
First, let's visualize the distribution of the missing data.
```{r}
vis_miss(aid)
vis_miss(aid,cluster = TRUE)
```
we decide to drop the observations that have missing values for the following reason:
1. "MNAR: Missing Not at Random - the missing is not random, it correlates with unobservable characteristics unknown to a researcher."
2. we still have 80% data left.
```{r}
aid = aid %>%
  na.omit(aid)

aid2007 = aid %>%
  filter(year==2007)

aid2012 = aid %>%
  filter(year==2012)
```

![](causal_graph.png)


# Causal Discovery


```{r}
dag <- dagitty("
dag {
bb=\"0,0,1,1\"
\"A:US_ODA\" [exposure,pos=\"0.272,0.239\"]
\"Y:Recipient_GDP_growth_rate\" [outcome,pos=\"0.672,0.254\"]
national_demand [latent,pos=\"0.540,0.050\"]
oda_gni [pos=\"0.446,0.310\"]
polity2 [pos=\"0.357,0.039\"]
population_growth_rate [pos=\"0.651,0.028\"]
recipient_trade_world [pos=\"0.412,0.504\"]
rest_world_aid [pos=\"0.397,0.159\"]
\"A:US_ODA\" -> \"Y:Recipient_GDP_growth_rate\"
\"A:US_ODA\" -> oda_gni
national_demand -> \"Y:Recipient_GDP_growth_rate\"
national_demand -> oda_gni
national_demand -> recipient_trade_world
oda_gni -> \"Y:Recipient_GDP_growth_rate\"
polity2 -> \"A:US_ODA\"
polity2 -> \"Y:Recipient_GDP_growth_rate\"
polity2 -> national_demand
polity2 -> rest_world_aid
population_growth_rate -> \"Y:Recipient_GDP_growth_rate\"
population_growth_rate -> national_demand
recipient_trade_world -> \"A:US_ODA\"
recipient_trade_world -> \"Y:Recipient_GDP_growth_rate\"
recipient_trade_world -> rest_world_aid
rest_world_aid -> \"Y:Recipient_GDP_growth_rate\"
rest_world_aid -> oda_gni
}
")
plot(dag)
```
The causal graph is constructed based on our prior assumptions and common sense:

1. The outcome(Y: GDP growth rate of the recipient) depends on the national demand, population growth rate, the foreign aid received, potentially its autocracy-democracy index(polity2), and the recipient’s openness (measured by its global trade).

2. We assume that our treatment, US ODA, affect the outcome via direct effect(the recipient receives the aid) and indirect effect of ODA_GNI. The idea for GNI is that given the same amount of foreign aid, if the aid amounts to a large portion of the recipient’s gross national income, this aid should have a larger impact on the recipient. A similar idea applies to the foreign aid provided by the rest of the world.

3. We assume the recipient country’s openness to global trading contributes to not only GDP growth but also the amount of aid it’s going to receive. The rationale behind the assumption is the potential economic welfare gains from an aid could strongly motivate the donor. For example, the donor might want to have an impact on, or take a share of, the recipient’s market. Finally, we think it’s reasonable to assume that national demand affects the recipient’s global trade.

4. The assumption we made polity2 a confounder that has an impact on a wide range of other variables. The rationale behind this assumption is that the donors might also be motivated by enlarging their political impact on the recipient, such as winning over political support. 


### alpha = 0.01
```{r}
causalAid = aid2012 %>%
  dplyr::select(-X,-country,-year)
suff_stat <- list(C = cor(causalAid), n = nrow(causalAid))
pc_aid <- pc(suff_stat, indepTest = gaussCItest, labels = colnames(causalAid), alpha = 0.01, skel.method = "stable.fast")

plot(pc_aid, main = "")
```

With a threshold of 0.01, the outcome is entirely seperated from the rest of variables. Therefore, we believe 0.01 is too strict and thus relax it to 0.05.

### alpha=0.05
```{r}
pc_aid <- pc(suff_stat, indepTest = gaussCItest, labels = colnames(causalAid), alpha = 0.05, skel.method = "stable.fast")
plot(pc_aid, main = "")
```
1. we are surprised to see polity2 is independent of all other variables. We suspect that we didn’t properly impute polity2.

2. to our surprise, there is no direct causal flow between world total aid and recipient’s growth. 










# Mixed Effect Model

## What is random effect and fixed effect?

## Our Model



# Regression Analysis
## Initial visualization 
```{r}
# ggplot(data = aid, aes(x = US_aid_total, y = GDP_total_growth))+
#   geom_point()
```

## The impact of U.S Foreign Aid on recipients

## Naive Model
```{r}
#US_lm <- lm(as.numeric(GDP_total_growth) ~ US_aid_total, data = aid)
```

## Mixed effect Model
```{r}
# US <- lmer(as.numeric(GDP_total_growth) ~ US_aid_total + (1 | country), data = aid)
# summary(US)
# confint(US)
```


```{r}
#re <- ranef(US)$country
```


```{r}
# predictInterval(US)   # for various model predictions, possibly with new data
# 
# REsim(US)             # mean, median and sd of the random effect estimates
# 
# plotREsim(REsim(US))  # plot the interval estimates
```

## Prediction
```{r}
# predict_no_re <- predict(US, re.form=NA)
# predict_lm <- predict(US_lm)
# predict_with_re <- predict(US)
```






















